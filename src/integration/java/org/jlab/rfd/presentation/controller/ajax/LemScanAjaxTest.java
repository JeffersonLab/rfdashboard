package org.jlab.rfd.presentation.controller.ajax;

import org.junit.Assert;
import org.junit.Test;

import javax.json.Json;
import javax.json.JsonObject;
import javax.json.JsonReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.StringReader;
import java.net.URL;

public class LemScanAjaxTest {

    private static final String LEM_SCAN_URL = "http://localhost:8080/RFDashboard/ajax/lem-scan";
    private JsonObject makeQuery(String query) throws IOException {
        JsonObject json;
        URL url = new URL(LEM_SCAN_URL + query);
        InputStream is = url.openStream();

        try (JsonReader reader = Json.createReader(is)) {
            json = reader.readObject();
        }
        return json;
    }

    @Test
    public void testBasicUsageDayScan() throws IOException {
        String expString = "{\"labels\":[\"North\",\"South\",\"Total\"]," +
                "\"data\":[" +
                "[[\"950\",\"null\"],[\"955\",\"null\"],[\"960\",\"null\"],[\"965\",\"null\"],[\"970\",\"null\"]," +
                "[\"975\",\"null\"],[\"980\",\"null\"],[\"985\",\"null\"],[\"990\",\"null\"],[\"995\",\"null\"]," +
                "[\"1000\",\"0.28807375\"],[\"1005\",\"0.32567875\"],[\"1010\",\"0.3716325\"]," +
                "[\"1015\",\"0.427835\"],[\"1020\",\"0.49661375\"],[\"1025\",\"0.58090875\"]," +
                "[\"1030\",\"0.684285\"],[\"1035\",\"0.8113275\"],[\"1040\",\"0.96778125\"],[\"1045\",\"1.161445\"]," +
                "[\"1050\",\"1.402675\"],[\"1055\",\"1.70415\"],[\"1060\",\"2.083\"],[\"1065\",\"2.560925\"]," +
                "[\"1070\",\"3.1652625\"],[\"1075\",\"3.9318875\"],[\"1080\",\"4.92895\"],[\"1085\",\"6.252875\"]," +
                "[\"1090\",\"8.018125\"],[\"1095\",\"10.376375\"],[\"1100\",\"13.533875\"],[\"1105\",\"17.80225\"]," +
                "[\"1110\",\"23.655875\"],[\"1115\",\"32.01125\"],[\"1120\",\"44.568125\"]," +
                "[\"1125\",\"3.9735625E15\"],[\"1130\",\"null\"],[\"1135\",\"null\"],[\"1140\",\"null\"]," +
                "[\"1145\",\"null\"],[\"1150\",\"null\"],[\"1155\",\"null\"],[\"1160\",\"null\"]," +
                "[\"1165\",\"null\"],[\"1170\",\"null\"],[\"1175\",\"null\"],[\"1180\",\"null\"]," +
                "[\"1185\",\"null\"],[\"1190\",\"null\"]],[[\"950\",\"null\"],[\"955\",\"null\"],[\"960\",\"null\"]," +
                "[\"965\",\"null\"],[\"970\",\"null\"],[\"975\",\"null\"],[\"980\",\"null\"],[\"985\",\"null\"]," +
                "[\"990\",\"null\"],[\"995\",\"null\"],[\"1000\",\"0.25228875\"],[\"1005\",\"0.28447\"]," +
                "[\"1010\",\"0.32281375\"],[\"1015\",\"0.36846125\"],[\"1020\",\"0.4230525\"]," +
                "[\"1025\",\"0.488195\"],[\"1030\",\"0.56554625\"],[\"1035\",\"0.6577775\"]," +
                "[\"1040\",\"0.76825125\"],[\"1045\",\"0.90122375\"],[\"1050\",\"1.06104\"],[\"1055\",\"1.252575\"]," +
                "[\"1060\",\"1.483675\"],[\"1065\",\"1.7664\"],[\"1070\",\"2.113175\"],[\"1075\",\"2.5388375\"]," +
                "[\"1080\",\"3.062825\"],[\"1085\",\"3.710825\"],[\"1090\",\"4.5128375\"],[\"1095\",\"5.50805\"]," +
                "[\"1100\",\"6.752325\"],[\"1105\",\"8.32775\"],[\"1110\",\"10.3564125\"],[\"1115\",\"12.984\"]," +
                "[\"1120\",\"16.40875\"],[\"1125\",\"20.94275\"],[\"1130\",\"27.16225\"],[\"1135\",\"36.413\"]," +
                "[\"1140\",\"null\"],[\"1145\",\"null\"],[\"1150\",\"null\"],[\"1155\",\"null\"],[\"1160\",\"null\"]," +
                "[\"1165\",\"null\"],[\"1170\",\"null\"],[\"1175\",\"null\"],[\"1180\",\"null\"],[\"1185\",\"null\"]," +
                "[\"1190\",\"null\"]],[[\"950\",\"null\"],[\"955\",\"null\"],[\"960\",\"null\"],[\"965\",\"null\"]," +
                "[\"970\",\"null\"],[\"975\",\"null\"],[\"980\",\"null\"],[\"985\",\"null\"],[\"990\",\"null\"]," +
                "[\"995\",\"null\"],[\"1000\",\"0.5403625000000001\"],[\"1005\",\"0.61014875\"]," +
                "[\"1010\",\"0.6944462499999999\"],[\"1015\",\"0.79629625\"],[\"1020\",\"0.91966625\"]," +
                "[\"1025\",\"1.06910375\"],[\"1030\",\"1.2498312500000002\"],[\"1035\",\"1.4691049999999999\"]," +
                "[\"1040\",\"1.7360325\"],[\"1045\",\"2.0626687500000003\"],[\"1050\",\"2.4637149999999997\"]," +
                "[\"1055\",\"2.956725\"],[\"1060\",\"3.566675\"],[\"1065\",\"4.327325\"],[\"1070\",\"5.2784375\"]," +
                "[\"1075\",\"6.470725\"],[\"1080\",\"7.9917750000000005\"],[\"1085\",\"9.9637\"]," +
                "[\"1090\",\"12.5309625\"],[\"1095\",\"15.884425\"],[\"1100\",\"20.2862\"]," +
                "[\"1105\",\"26.130000000000003\"],[\"1110\",\"34.0122875\"],[\"1115\",\"44.99525\"]," +
                "[\"1120\",\"60.97687500000001\"],[\"1125\",\"3.973562500000021E15\"],[\"1130\",\"null\"]," +
                "[\"1135\",\"null\"],[\"1140\",\"null\"],[\"1145\",\"null\"],[\"1150\",\"null\"]," +
                "[\"1155\",\"null\"],[\"1160\",\"null\"],[\"1165\",\"null\"],[\"1170\",\"null\"],[\"1175\",\"null\"]," +
                "[\"1180\",\"null\"],[\"1185\",\"null\"],[\"1190\",\"null\"]]]}";

        JsonObject exp;
        try (JsonReader reader = Json.createReader(new StringReader(expString))) {
            exp = reader.readObject();
        }

        JsonObject result = makeQuery("?type=day-scan&date=2016-12-17");
        Assert.assertEquals(exp, result);
    }

    @Test
    public void testBasicUsageReachScan() throws IOException {

        String expString = "{\"labels\":[\"Reach\"]," +
                "\"data\":[[[1481932800000,\"1080.0208552556512\"],[1482019200000,\"1077.074019854189\"]]]}";
        JsonObject exp;
        try (JsonReader reader = Json.createReader(new StringReader(expString))) {
            exp = reader.readObject();
        }

        JsonObject result = makeQuery("?type=reach-scan&start=2016-12-17&end=2016-12-19");
        Assert.assertEquals(exp, result);
    }
}
